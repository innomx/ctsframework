<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>ctsframework : A Modular Framework for Performing Clinical Trial Simulations</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<style type="text/css">.Rttt table {font-family: "Times New Roman", Times, serif;font-size: 9pt;border-collapse: collapse;padding: 0px;margin: 0px;}.Rttt th {background-color: #ccc;}.Rttt th, .Rttt td {border: 1pt solid black;padding: 0.1ex 2ex;text-align: center;white-space:nowrap;}.Rttt .Rttt-rl {text-align: left;}.Rttt caption {text-align: left;font-family: "Times New Roman", Times, serif;font-size: 12pt;font-weight: bold;}.Rttt tfoot tr, .Rttt tfoot tr td {border: 0;padding: 0;margin: 0;}.Rttt tfoot tr td p {text-align: left;font-family: "Times New Roman", Times, serif;font-size: 9pt;padding: 0;margin: 0;}</style>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore"><code>ctsframework</code> : A Modular
Framework for Performing Clinical Trial Simulations</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>One of the core elements of pharmacometrics is to perform clinical
trial simulations (CTS) to help inform decisions in clinical drug
development (for instance, to explore different dosing regimens). In
most cases, R is a suitable environment for this, and there are many
excellent packages that can be leveraged. In practice, what tends to
happen is that there is a desire to explore a large number of “what if”
scenarios, either different treatments, populations, models or other
tweaked parameters, and as a consequence the resulting code tends to
grow in complexity and become cumbersome to manage. The purpose of the
<code>ctsframework</code> package is to make the CTS process more
modular, and to help manage the complexity.</p>
<p>Much as the infamous <code>ggplot2</code> package is designed around
a “grammar of graphics”, this package offers something like a “grammar”
of semantically named functions that correspond to different components
of a clinical trial simulation. Designed for maximum flexibility and
convenience. The central object is the <code>scenario</code>, which is
composed of specific “modules” corresponding to different aspects of
CTS.</p>
<p>Withing <code>ctsframework</code>, a CTS is specified by one or more
scenarios. A scenario is broken down into multiple steps or
“modules”:</p>
<ul>
<li><p><strong>parameters</strong>: This module can be used to specify
any general parameters that are related to a scenario. An example could
be the sample size, for instance.</p></li>
<li><p><strong>population</strong>: In most clinical trial simulations,
the starting point is defining a population of ‘virtual patients’. This
module is where you would specify the distribution of demographic
characteristics, implement inclusion/exclusion criteria and so
on.</p></li>
<li><p><strong>subject_model</strong>: I don’t usually like referring to
people as ‘subjects’, but this is the common terminology used in
clinical trials. This is the place where you could specify subject-level
differences, like covariate effects or between-subject variability, and
individual-level parameters.</p></li>
<li><p><strong>treatment</strong>: In most clinical trial simulations,
the treatment will be of primary interest. This module is intended for
specifying treatments, which can be a dose, formulation etc.</p></li>
<li><p><strong>pkpd_model</strong>: In pharmacometric applications,
there will typically be a PK/PD model consisting of differential
equations, which can be specified in this module.</p></li>
<li><p><strong>simulation</strong>: At this point, it’s time to carry
out the actual simulation. This module contains the code that runs
it.</p></li>
<li><p><strong>endpoints</strong>: From the simulation output (which
could for instance be a PK concentration-time profile, or some other
complex object), a number of endpoints can be derived, which is what
this module is intended for.</p></li>
<li><p><strong>summarization</strong>: This module is intended for
summarizing results across individuals, such as taking means, medians,
specific quantiles, etc. (Note: this module can only be used to
summarize results within a scenario, not across scenarios; the latter is
the purpose of the <code>collate()</code> function, described
below).</p></li>
</ul>
<p>In fact, each module is very general, and essentially equivalent;
each can contain any number of named items of arbitrary complexity. The
semantic module names are simply there to help make the code more
organized and intentional. All the modules are optional.</p>
<p>The power of the framework is that each module subitem can be
overridden to creat a new scenario. At each step, the submitems of the
modules that appear higher up are available and can be used in the
subsequent computation. By mixing and matching different modules, it is
easy to specify many different scenarios without a lot of code
repetition.</p>
</div>
<div id="a-complete-pharmacometrics-example" class="section level2">
<h2>A complete pharmacometrics example</h2>
<p>For this example we will use the following packages, so load them
first:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(mrgsolve)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(linpk)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(mappings)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(ttt)</span></code></pre></div>
<p>Also, for reproducibility we had better set the RNG seed:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2755139</span>)</span></code></pre></div>
<div id="defining-a-base-scenario" class="section level3">
<h3>Defining a base scenario</h3>
<p>Now, we begin by defining our first scenario, which will be our
“base” scenario (latter we will see how we can derive new scenarios from
this one). The example will be to simulate from a simple 2-compartment
population PK model (it could be a simplified monoclonal antibody
model). This code block will apepar quite long, but we will go through
and explain each elements afterwards.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>base_scenario <span class="ot">&lt;-</span> <span class="fu">scenario</span>(<span class="at">name=</span><span class="st">&quot;Base Scenario&quot;</span>,</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="at">parameters =</span> <span class="fu">parameters</span>(</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        <span class="at">n  =</span> <span class="dv">1000</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="at">th =</span> <span class="fu">list</span>(<span class="at">CL=</span><span class="fl">0.0194</span>, <span class="at">V1=</span><span class="fl">4.51</span>, <span class="at">Q=</span><span class="fl">0.0435</span>, <span class="at">V2=</span><span class="fl">2.82</span>, <span class="at">CL_WT=</span><span class="fl">0.46</span>, <span class="at">V1_WT=</span><span class="fl">0.87</span>),</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>        <span class="at">om =</span> <span class="fu">LTmat</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>), <span class="at">.names=</span><span class="fu">c</span>(<span class="st">&quot;nCL&quot;</span>, <span class="st">&quot;nV1&quot;</span>))</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    ),</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">population</span>(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>        <span class="at">wtcatfn =</span> <span class="fu">cut_mapping</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">100</span>, <span class="cn">Inf</span>), <span class="fu">c</span>(<span class="st">&quot;&lt;60 kg&quot;</span>, <span class="st">&quot;60 to &lt;100 kg&quot;</span>, <span class="st">&quot;&gt;= 100 kg&quot;</span>), <span class="at">right=</span><span class="cn">TRUE</span>),</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        {</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>            <span class="fu">data.table</span>(<span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span>n, <span class="at">wt=</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(n, <span class="fu">log</span>(<span class="dv">74</span>), <span class="fl">0.2</span>)))[, wtcat <span class="sc">:=</span> <span class="fu">wtcatfn</span>(wt)]</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>        }</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    ),</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="at">subject_model =</span> <span class="fu">subject_model</span>(</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>        {</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>            eta <span class="ot">&lt;-</span> <span class="fu">generateETA</span>(n, <span class="at">omega=</span>om)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>            <span class="fu">cbind</span>(population, eta)[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>                <span class="at">CL =</span> th<span class="sc">$</span>CL <span class="sc">*</span> <span class="fu">exp</span>(nCL) <span class="sc">*</span> (wt<span class="sc">/</span><span class="dv">70</span>)<span class="sc">^</span>th<span class="sc">$</span>CL_WT,</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>                <span class="at">V1 =</span> th<span class="sc">$</span>V1 <span class="sc">*</span> <span class="fu">exp</span>(nV1) <span class="sc">*</span> (wt<span class="sc">/</span><span class="dv">70</span>)<span class="sc">^</span>th<span class="sc">$</span>V1_WT</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>            )]</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>        }</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    ),</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">treatment</span>(</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>        {</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>            population[, .(ID, <span class="at">amt=</span>wt<span class="sc">*</span><span class="dv">3</span>, <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">5</span>, <span class="at">ii=</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>        }</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>    ),</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>    <span class="at">pkpd_model =</span> <span class="fu">pkpd_model</span>(</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>        {</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>            model.code <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="st">            [param]   CL=1, V1=1, V2=1, Q=1</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="st">            [pkmodel] cmt=&quot;CENTRAL PERIPH&quot;</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="st">            [table]   capture conc = CENTRAL/V1;</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="st">            &#39;</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>            <span class="fu">mcode_cache</span>(<span class="st">&quot;2cmt&quot;</span>, model.code)</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>        }</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>    ),</span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>    <span class="at">simulation =</span> <span class="fu">simulation</span>(</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>        {</span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>            eoi <span class="ot">&lt;-</span> <span class="fu">realize_addl</span>(<span class="fu">as.ev</span>(treatment)) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">with</span>(time <span class="sc">+</span> (amt<span class="sc">/</span>rate)) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>            sim <span class="ot">&lt;-</span> pkpd_model <span class="sc">|&gt;</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>                <span class="fu">param</span>(th) <span class="sc">|&gt;</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>                <span class="fu">idata_set</span>(subject_model) <span class="sc">|&gt;</span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>                <span class="fu">ev</span>(<span class="fu">as.ev</span>(treatment)) <span class="sc">|&gt;</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>                <span class="fu">Req</span>(conc) <span class="sc">|&gt;</span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>                <span class="fu">update</span>(<span class="at">end=</span><span class="dv">12</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="at">delta=</span><span class="dv">24</span>, <span class="at">add=</span>eoi) <span class="sc">|&gt;</span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>                <span class="fu">mrgsim</span>()</span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>            simdat <span class="ot">&lt;-</span> sim <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">as.data.table</span>()</span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a>            population[simdat, on<span class="ot">=</span><span class="st">&quot;ID&quot;</span>]</span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>        }</span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a>    ),</span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>    <span class="at">endpoints =</span> <span class="fu">endpoints</span>(</span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a>        {</span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>            auc.by.trapezoid <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">sum</span>(<span class="fl">0.5</span><span class="sc">*</span><span class="fu">diff</span>(x)<span class="sc">*</span>(y[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> y[<span class="sc">-</span><span class="fu">length</span>(y)]))</span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>            simulation[time <span class="sc">&gt;=</span> <span class="dv">6</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, .(</span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a>                <span class="at">cmin=</span><span class="fu">min</span>(conc),</span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>                <span class="at">cmax=</span><span class="fu">max</span>(conc),</span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a>                <span class="at">cavg=</span><span class="fu">auc.by.trapezoid</span>(time, conc)<span class="sc">/</span><span class="fu">diff</span>(<span class="fu">range</span>(time))),</span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>            by<span class="ot">=</span>ID][population, on<span class="ot">=</span><span class="st">&quot;ID&quot;</span>]</span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a>        },</span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a>        <span class="at">outputs =</span> <span class="fu">csv_output</span>(endpoints, <span class="at">name=</span><span class="st">&quot;sim-exposure&quot;</span>)</span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a>    ),</span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a>    <span class="at">summarization =</span> <span class="fu">summarization</span>(</span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a>        {</span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a>            <span class="fu">list</span>(</span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a>                <span class="at">overall =</span> simulation[, <span class="fu">qi</span>(conc, <span class="at">level=</span><span class="fl">0.9</span>), <span class="at">by=</span>time],</span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a>                <span class="at">bywtcat =</span> simulation[, <span class="fu">qi</span>(conc, <span class="at">level=</span><span class="fl">0.9</span>), <span class="at">by=</span>.(time, <span class="at">wtcat=</span><span class="fu">wtcatfn</span>(wt))]</span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a>            )</span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a>        },</span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a>        <span class="at">outputs =</span> <span class="fu">output_list</span>(</span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a>            <span class="fu">graphical_output</span>(<span class="at">name=</span><span class="st">&quot;sim-profile-90pctPI-overall&quot;</span>, <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, {</span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a>                <span class="fu">ggplot</span>(summarization<span class="sc">$</span>overall, <span class="fu">aes</span>(<span class="at">x=</span>time<span class="sc">/</span>(<span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>), <span class="at">y=</span>q0<span class="fl">.5</span>, <span class="at">ymin=</span>q0<span class="fl">.05</span>, <span class="at">ymax=</span>q0<span class="fl">.95</span>)) <span class="sc">+</span></span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a>                    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Time (weeks)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Concentration (\U{00B5}g/mL)&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a>                    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a>                    <span class="fu">geom_ribbon</span>(<span class="at">color=</span><span class="cn">NA</span>, <span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a>                    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a>                    <span class="fu">theme_bw</span>()</span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a>            }),</span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a>            <span class="fu">graphical_output</span>(<span class="at">name=</span><span class="st">&quot;sim-profile-90pctPI-bywtcat&quot;</span>, <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, {</span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a>                <span class="fu">ggplot</span>(summarization<span class="sc">$</span>bywtcat, <span class="fu">aes</span>(<span class="at">x=</span>time<span class="sc">/</span>(<span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>), <span class="at">y=</span>q0<span class="fl">.5</span>, <span class="at">ymin=</span>q0<span class="fl">.05</span>, <span class="at">ymax=</span>q0<span class="fl">.95</span>)) <span class="sc">+</span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a>                    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Time (weeks)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Concentration (\U{00B5}g/mL)&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-97"><a href="#cb3-97" tabindex="-1"></a>                    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb3-98"><a href="#cb3-98" tabindex="-1"></a>                    <span class="fu">facet_wrap</span>(<span class="sc">~</span> wtcat) <span class="sc">+</span></span>
<span id="cb3-99"><a href="#cb3-99" tabindex="-1"></a>                    <span class="fu">geom_ribbon</span>(<span class="at">color=</span><span class="cn">NA</span>, <span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb3-100"><a href="#cb3-100" tabindex="-1"></a>                    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-101"><a href="#cb3-101" tabindex="-1"></a>                    <span class="fu">theme_bw</span>()</span>
<span id="cb3-102"><a href="#cb3-102" tabindex="-1"></a>            })</span>
<span id="cb3-103"><a href="#cb3-103" tabindex="-1"></a>        )</span>
<span id="cb3-104"><a href="#cb3-104" tabindex="-1"></a>    )</span>
<span id="cb3-105"><a href="#cb3-105" tabindex="-1"></a>)</span></code></pre></div>
<p>Now, we will go through the above code and briefly explain each
module separately.</p>
<p>We start by looking a the <code>parameters</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>    parameters <span class="ot">=</span> <span class="fu">parameters</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>        <span class="at">n  =</span> <span class="dv">1000</span>,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>        <span class="at">th =</span> <span class="fu">list</span>(<span class="at">CL=</span><span class="fl">0.0194</span>, <span class="at">V1=</span><span class="fl">4.51</span>, <span class="at">Q=</span><span class="fl">0.0435</span>, <span class="at">V2=</span><span class="fl">2.82</span>, <span class="at">CL_WT=</span><span class="fl">0.46</span>, <span class="at">V1_WT=</span><span class="fl">0.87</span>),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        <span class="at">om =</span> <span class="fu">LTmat</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>), <span class="at">.names=</span><span class="fu">c</span>(<span class="st">&quot;nCL&quot;</span>, <span class="st">&quot;nV1&quot;</span>))</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    )</span></code></pre></div>
<p>We have specified a 3 parameters: the number of individual we want to
simulate (n), a THETA vector of fixed-effect parameters (th), and an
OMEGA matrix for between-individual variability (om). These parameters
will be used in subsequent code. Since each module is completely
general, we are free to specify whatever we want, and whatever help to
make the code more organized.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>    population <span class="ot">=</span> <span class="fu">population</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>        <span class="at">wtcatfn =</span> <span class="fu">cut_mapping</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">100</span>, <span class="cn">Inf</span>), <span class="fu">c</span>(<span class="st">&quot;&lt;60 kg&quot;</span>, <span class="st">&quot;60 to &lt;100 kg&quot;</span>, <span class="st">&quot;&gt;= 100 kg&quot;</span>), <span class="at">right=</span><span class="cn">TRUE</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>        {</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>            <span class="fu">data.table</span>(<span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span>n, <span class="at">wt=</span><span class="fu">exp</span>(<span class="fu">rnorm</span>(n, <span class="fu">log</span>(<span class="dv">74</span>), <span class="fl">0.2</span>)))[, wtcat <span class="sc">:=</span> <span class="fu">wtcatfn</span>(wt)]</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        }</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    )</span></code></pre></div>
<p>There are actually 2 things being specified here. One is a named
function <code>wtcatfn()</code> that transforms body weight into weight
categories. The other is an unnamed code block that generates a
population dataset. Note that the parameter <code>n</code> appears in
this code block, as does the <code>wtcatfn()</code> defined previously.
Again, anything that appear higher up is accessible in the code.
However, it is important to note that an unnamed code block such as we
have used here can be referred in subsequent modules using the module
name in which is was specified (in this case,
<code>population</code>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>    subject_model <span class="ot">=</span> <span class="fu">subject_model</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>        {</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>            eta <span class="ot">&lt;-</span> <span class="fu">generateETA</span>(n, <span class="at">omega=</span>om)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>            <span class="fu">cbind</span>(population, eta)[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                <span class="at">CL =</span> th<span class="sc">$</span>CL <span class="sc">*</span> <span class="fu">exp</span>(nCL) <span class="sc">*</span> (wt<span class="sc">/</span><span class="dv">70</span>)<span class="sc">^</span>th<span class="sc">$</span>CL_WT,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                <span class="at">V1 =</span> th<span class="sc">$</span>V1 <span class="sc">*</span> <span class="fu">exp</span>(nV1) <span class="sc">*</span> (wt<span class="sc">/</span><span class="dv">70</span>)<span class="sc">^</span>th<span class="sc">$</span>V1_WT</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>            )]</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>        }</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    )</span></code></pre></div>
<p>In an unnamed code block, we use the augment the population dataset
with individual level random effects and parameters.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>    treatment <span class="ot">=</span> <span class="fu">treatment</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>        {</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>            population[, .(ID, <span class="at">amt=</span>wt<span class="sc">*</span><span class="dv">3</span>, <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">5</span>, <span class="at">ii=</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        }</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    )</span></code></pre></div>
<p>For the treatment, we will assume a dose of 3 mg/kg given as a
half-hour infusion every two weeks over 12 weeks.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>    pkpd_model <span class="ot">=</span> <span class="fu">pkpd_model</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>        {</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>            model.code <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="st">            [param]   CL=1, V1=1, V2=1, Q=1</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="st">            [pkmodel] cmt=&quot;CENTRAL PERIPH&quot;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="st">            [table]   capture conc = CENTRAL/V1;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="st">            &#39;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>            <span class="fu">mcode_cache</span>(<span class="st">&quot;2cmt&quot;</span>, model.code)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        }</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    )</span></code></pre></div>
<p>In an unnamed code block, the 2-compartment PK model is defined using
<code>mrgsolve</code> syntax (the <code>mrgsolve</code> package has
great documentation). The result is the compiled model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>    simulation <span class="ot">=</span> <span class="fu">simulation</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>        {</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>            eoi <span class="ot">&lt;-</span> <span class="fu">realize_addl</span>(<span class="fu">as.ev</span>(treatment)) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">with</span>(time <span class="sc">+</span> (amt<span class="sc">/</span>rate)) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>            sim <span class="ot">&lt;-</span> pkpd_model <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                <span class="fu">param</span>(th) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                <span class="fu">idata_set</span>(subject_model) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>                <span class="fu">ev</span>(<span class="fu">as.ev</span>(treatment)) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>                <span class="fu">Req</span>(conc) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>                <span class="fu">update</span>(<span class="at">end=</span><span class="dv">12</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="at">delta=</span><span class="dv">24</span>, <span class="at">add=</span>eoi) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>                <span class="fu">mrgsim</span>()</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>            simdat <span class="ot">&lt;-</span> sim <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">as.data.table</span>()</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>            population[simdat, on<span class="ot">=</span><span class="st">&quot;ID&quot;</span>]</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>        }</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    )</span></code></pre></div>
<p>In an unnamed code block, the concentration-time profiles are
generated using <code>mrgsolve</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>    endpoints <span class="ot">=</span> <span class="fu">endpoints</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>        {</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>            auc.by.trapezoid <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">sum</span>(<span class="fl">0.5</span><span class="sc">*</span><span class="fu">diff</span>(x)<span class="sc">*</span>(y[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> y[<span class="sc">-</span><span class="fu">length</span>(y)]))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>            simulation[time <span class="sc">&gt;=</span> <span class="dv">6</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, .(</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>                <span class="at">cmin=</span><span class="fu">min</span>(conc),</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>                <span class="at">cmax=</span><span class="fu">max</span>(conc),</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>                <span class="at">cavg=</span><span class="fu">auc.by.trapezoid</span>(time, conc)<span class="sc">/</span><span class="fu">diff</span>(<span class="fu">range</span>(time))),</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>            by<span class="ot">=</span>ID][population, on<span class="ot">=</span><span class="st">&quot;ID&quot;</span>]</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>        },</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>        <span class="at">outputs =</span> <span class="fu">csv_output</span>(endpoints, <span class="at">name=</span><span class="st">&quot;sim-exposure&quot;</span>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    )</span></code></pre></div>
<p>Next, we derive some “endpoints”, in this case exposure metrics over
the last treament interval, for each individual. For the first time, a
module contains an output – the resulting dataframe will be stored in a
CSV file. The location of this CSV file will be explained later.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>    summarization <span class="ot">=</span> <span class="fu">summarization</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>        {</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>            <span class="fu">list</span>(</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>                <span class="at">overall =</span> simulation[, <span class="fu">qi</span>(conc, <span class="at">level=</span><span class="fl">0.9</span>), <span class="at">by=</span>time],</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>                <span class="at">bywtcat =</span> simulation[, <span class="fu">qi</span>(conc, <span class="at">level=</span><span class="fl">0.9</span>), <span class="at">by=</span>.(time, <span class="at">wtcat=</span><span class="fu">wtcatfn</span>(wt))]</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>            )</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>        },</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>        <span class="at">outputs =</span> <span class="fu">output_list</span>(</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>            <span class="fu">graphical_output</span>(<span class="at">name=</span><span class="st">&quot;sim-profile-90pctPI-overall&quot;</span>, <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, {</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>                <span class="fu">ggplot</span>(summarization<span class="sc">$</span>overall, <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>q0<span class="fl">.5</span>, <span class="at">ymin=</span>q0<span class="fl">.05</span>, <span class="at">ymax=</span>q0<span class="fl">.95</span>)) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>                    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Time (h)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Concentration (\U{00B5}g/mL)&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>                    <span class="fu">geom_ribbon</span>(<span class="at">color=</span><span class="cn">NA</span>, <span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>                    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>                    <span class="fu">theme_bw</span>()</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>            }),</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>            <span class="fu">graphical_output</span>(<span class="at">name=</span><span class="st">&quot;sim-profile-90pctPI-bywtcat&quot;</span>, <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, {</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>                <span class="fu">ggplot</span>(summarization<span class="sc">$</span>bywtcat, <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>q0<span class="fl">.5</span>, <span class="at">ymin=</span>q0<span class="fl">.05</span>, <span class="at">ymax=</span>q0<span class="fl">.95</span>)) <span class="sc">+</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>                    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Time (h)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Concentration (\U{00B5}g/mL)&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>                    <span class="fu">facet_wrap</span>(<span class="sc">~</span> wtcat) <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>                    <span class="fu">geom_ribbon</span>(<span class="at">color=</span><span class="cn">NA</span>, <span class="at">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>                    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>                    <span class="fu">theme_bw</span>()</span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>            })</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>        )</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>    )</span></code></pre></div>
<p>We summarize the PK concentration-time profiles by taking the median,
5th and 95th percentiles at each time point. We do this both overall,
and stratified by weight category. Then, we produce two graphical
outputs using <code>ggplot</code>.</p>
</div>
<div id="running-a-scenario" class="section level3">
<h3>Running a scenario</h3>
<p>To run the base scenario, we do the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">CTS</span>(base_scenario)</span></code></pre></div>
<p>After the scenario has finished running, there is a new folder in the
current directory named “./cts_results/2025-06-06/Base Scenario” which
contains the specified outputs each in their own subfolder corresponding
to the name of the module where it was specified. For instance, the
subfolder named <code>summarization</code> contains these 2 plots:</p>
<p><img role="img" src="data:image/png;base64,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" /><!-- --><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>The way the folder structure is defined is as follows. When the
<code>CTS()</code> function is called, a <code>.path</code> argument
specifies the root path for the simulation; the defaut is
<code>cts_results/dd-mm-yyyy</code>, where <code>dd-mm-yyyy</code> is
the current date. Under this root folder, there will be a subfolder for
each scenario, named according to the scenario name (each scenario has a
name attribute, the default being <code>Scenario</code> followed by a
sequential number). Then, under each scenario folder there may be
subfolders corresponding to individual modules. This folder structure
helps to keep things organized neatly.</p>
<p>The simulation root folder also contains a file called
<code>scenarios.csv</code> that contains useful information about each
scenario that has been run.</p>
</div>
<div id="deriving-a-new-scenario-from-an-existing-one" class="section level3">
<h3>Deriving a new scenario from an existing one</h3>
<p>Often there is more that one scenario to simulate, and here’s where
it starts to get interesting. We can derive a new scenario from an
existing one by essentially specifying only the parts that we want to
override.</p>
<p>Here, we will derive two new scenarios from the base scenario to
explore dosing the is independent of body weight (recall that the base
regimen was 3 mg/kg Q2W): 200 mg Q2W, and 300 mg Q3W.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>scenario_fixed_200mg_q2w <span class="ot">&lt;-</span> <span class="fu">derive_scenario</span>(base_scenario,</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">treatment</span>(<span class="at">name=</span><span class="st">&quot;200 mg Q2W&quot;</span>, {</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>        population[, .(ID, <span class="at">amt=</span><span class="dv">200</span>, <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">5</span>, <span class="at">ii=</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    })</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>scenario_fixed_300mg_q3w <span class="ot">&lt;-</span> <span class="fu">derive_scenario</span>(base_scenario,</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">treatment</span>(<span class="at">name=</span><span class="st">&quot;300 mg Q3W&quot;</span>, {</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>        population[, .(ID, <span class="at">amt=</span><span class="dv">300</span>, <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">3</span>, <span class="at">ii=</span><span class="dv">3</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    })</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>)</span></code></pre></div>
<p>Notice that we only specified the <code>treatment</code> module, and
within that module only the unnamed code block. Everything else stays as
it was in the base scenario, and all the modules downstream from
<code>treatment</code> will automatically pick up the new code when the
derived scenarios are run.</p>
</div>
<div id="creating-a-scenario-list" class="section level3">
<h3>Creating a scenario list</h3>
<p>Now, we could run each of the drived scenarios independently, but
instead will will combine them into a list that can be run using a
single call:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>sclist <span class="ot">&lt;-</span> <span class="fu">scenario_list</span>(base_scenario, scenario_fixed_200mg_q2w, scenario_fixed_300mg_q3w)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">CTS</span>(sclist)</span></code></pre></div>
<p>All 3 scenario are execuated.</p>
</div>
<div id="creating-a-scenario-grid" class="section level3">
<h3>Creating a scenario grid</h3>
<p>Frequently, we want to explore all possible combinations of different
factors. For this, we can use as scenario grid. Here, we will simulate
each of 3 dosing regimens under 2 different models, one with extimated
body weight exponents for allometric scaling, and the other with fixed
(theoretical) exponents. We can specify this as follows:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>scgrid <span class="ot">&lt;-</span> <span class="fu">scenario_grid</span>(base_scenario,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="at">parameters =</span> <span class="fu">list</span>(</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>        <span class="fu">parameters</span>(<span class="at">name=</span><span class="st">&quot;Estimated allometry&quot;</span>),</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>        <span class="fu">parameters</span>(<span class="at">name=</span><span class="st">&quot;Fixed allometry&quot;</span>,</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>            <span class="at">th =</span> <span class="fu">list</span>(<span class="at">CL=</span><span class="fl">0.0194</span>, <span class="at">V1=</span><span class="fl">4.51</span>, <span class="at">Q=</span><span class="fl">0.0435</span>, <span class="at">V2=</span><span class="fl">2.82</span>, <span class="at">CL_WT=</span><span class="fl">0.75</span>, <span class="at">V1_WT=</span><span class="fl">1.00</span>))</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    ),</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">list</span>(</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>        <span class="fu">treatment</span>(<span class="at">name=</span><span class="st">&quot;3 mg/kg Q2W&quot;</span>, {population[, .(ID, <span class="at">amt=</span>wt<span class="sc">*</span><span class="dv">3</span>, <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">5</span>, <span class="at">ii=</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]}),</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>        <span class="fu">treatment</span>(<span class="at">name=</span><span class="st">&quot;200 mg Q2W&quot;</span>,  {population[, .(ID, <span class="at">amt=</span><span class="dv">200</span>,  <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">5</span>, <span class="at">ii=</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]}),</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>        <span class="fu">treatment</span>(<span class="at">name=</span><span class="st">&quot;300 mg Q3W&quot;</span>,  {population[, .(ID, <span class="at">amt=</span><span class="dv">300</span>,  <span class="at">tinf=</span><span class="fl">0.5</span>, <span class="at">addl=</span><span class="dv">3</span>, <span class="at">ii=</span><span class="dv">3</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>)]})</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    )</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>)</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="fu">CTS</span>(scgrid)</span></code></pre></div>
<p>Each of the 6 scenario will generate the same outputs as the base
scenario, using the specified parameters and treatments. Again, we only
need to specify the elements we wish to override. Giving the modules
discriptive names will be helpful in the next section when we combine
the various scenarios.</p>
</div>
<div id="putting-it-all-together" class="section level3">
<h3>Putting it all together</h3>
<p>While outputs from individual scenarios can be important, at the end
of the day, the goal is often to produce a few key tables and/or figures
that summarize and compare a collection of different scenarios. That is
the purpose of the <code>collate()</code> function.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">collate</span>(<span class="st">&quot;endpoints/sim-exposure.csv&quot;</span>)</span></code></pre></div>
<p>What happens is, the outputs generated separately for each scenario
are merged together, along with additional information like the names we
gave to each of the modules.</p>
<p>Hence, we can now produce a nice table to summarize our results
across all 6 scenarios:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[scenario <span class="sc">%in%</span> <span class="fu">names</span>(scgrid)]</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(dat, <span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">&quot;parameters&quot;</span>, <span class="st">&quot;treatment&quot;</span>), <span class="at">measure.vars=</span><span class="fu">c</span>(<span class="st">&quot;cmin&quot;</span>, <span class="st">&quot;cmax&quot;</span>, <span class="st">&quot;cavg&quot;</span>))</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">text2mapping</span>(<span class="st">&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="st">cmin | C&lt;sub&gt;min,ss&lt;/sub&gt; (μg/mL)</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="st">cmax | C&lt;sub&gt;max,ss&lt;/sub&gt; (μg/mL)</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="st">cavg | C&lt;sub&gt;avg,ss&lt;/sub&gt; (μg/mL)</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>dat2<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">m</span>(dat2<span class="sc">$</span>variable)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>dat2<span class="sc">$</span>parameters <span class="ot">&lt;-</span> <span class="fu">cf</span>(dat2<span class="sc">$</span>parameters)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>dat2<span class="sc">$</span>treatment  <span class="ot">&lt;-</span> <span class="fu">cf</span>(dat2<span class="sc">$</span>treatment)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="fu">label</span>(dat2<span class="sc">$</span>parameters) <span class="ot">&lt;-</span> <span class="st">&quot;Model&quot;</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="fu">label</span>(dat2<span class="sc">$</span>variable)   <span class="ot">&lt;-</span> <span class="st">&quot;Exposure&lt;br/&gt;Metric&quot;</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="fu">ttt</span>(value <span class="sc">~</span> parameters <span class="sc">+</span> variable <span class="sc">|</span> treatment, <span class="at">data=</span>dat2, <span class="at">lab=</span><span class="st">&quot;Regimen&lt;br/&gt;Median [90% PI]&quot;</span>,</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>    <span class="at">render=</span><span class="cf">function</span>(x) <span class="fu">with</span>(<span class="fu">stats.apply.rounding</span>(<span class="fu">stats.default</span>(x)),</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;%s [%s, %s]&quot;</span>, MEDIAN, q05, q95)))</span></code></pre></div>
<div class="Rttt">
<table>
<thead>
<tr>
<th rowspan="2" class="Rttt-rlh">Model</th>
<th rowspan="2" class="Rttt-rlh">Exposure<br />Metric</th>
<th colspan="3" class="Rttt-lab">Regimen<br />Median [90% PI]</th>
</tr>
<tr>
<th class="Rttt-cl Rttt-cl-lvl1">3 mg/kg Q2W</th>
<th class="Rttt-cl Rttt-cl-lvl1">200 mg Q2W</th>
<th class="Rttt-cl Rttt-cl-lvl1">300 mg Q3W</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" class="Rttt-rl Rttt-rl-lvl2">Estimated allometry</td>
<td class="Rttt-rl Rttt-rl-lvl1">C<sub>min,ss</sub> (μg/mL)</td>
<td>18.6 [8.29, 33.8]</td>
<td>16.5 [7.62, 29.1]</td>
<td>13.1 [5.06, 25.4]</td>
</tr>
<tr>
<td class="Rttt-rl Rttt-rl-lvl1">C<sub>max,ss</sub> (μg/mL)</td>
<td>67.6 [45.4, 105]</td>
<td>61.2 [37.8, 98.1]</td>
<td>78.5 [47.3, 129]</td>
</tr>
<tr>
<td class="Rttt-rl Rttt-rl-lvl1">C<sub>avg,ss</sub> (μg/mL)</td>
<td>33.0 [19.5, 54.1]</td>
<td>29.6 [18.2, 47.8]</td>
<td>29.7 [18.3, 48.5]</td>
</tr>
<tr>
<td rowspan="3" class="Rttt-rl Rttt-rl-lvl2">Fixed allometry</td>
<td class="Rttt-rl Rttt-rl-lvl1">C<sub>min,ss</sub> (μg/mL)</td>
<td>18.1 [8.19, 32.1]</td>
<td>16.1 [7.46, 29.9]</td>
<td>12.9 [4.87, 25.8]</td>
</tr>
<tr>
<td class="Rttt-rl Rttt-rl-lvl1">C<sub>max,ss</sub> (μg/mL)</td>
<td>67.3 [44.8, 100]</td>
<td>61.0 [35.7, 101]</td>
<td>77.6 [44.9, 130]</td>
</tr>
<tr>
<td class="Rttt-rl Rttt-rl-lvl1">C<sub>avg,ss</sub> (μg/mL)</td>
<td>32.4 [20.1, 52.3]</td>
<td>28.9 [17.4, 48.3]</td>
<td>29.0 [17.4, 48.7]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="managing-rng-seeds" class="section level2">
<h2>Managing RNG seeds</h2>
<p>Because simulations usually involve the generation of random data,
storing RNG seeds is important for reproducibility. By default, each new
scenario gets its own unique seed (which can be overridden) that gets
stored with the object. Each scenario’s RNG seed is stored in the
<code>scenarios.csv</code> table, so it can easily be reproduced. Still
it is a good idea to use <code>set.seed()</code> at the start.
Individual modules can also have their own seeds, but by default they do
not. If it were desired to simulate multiple different treatments with
the same population, for instance, then that could be accomplished be
having a common RNG seed for the <code>population</code> module.</p>
<p>When a scenario or module has its own RNG seed specified, then the
current RNG state will be saved before running the scenario or module
and restored afterwards.</p>
</div>
<div id="tbd" class="section level2">
<h2>TBD</h2>
<ul>
<li>uncertainty/repetition</li>
<li>caching</li>
<li>parallelization</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
